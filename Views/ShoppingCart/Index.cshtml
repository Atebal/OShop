@model OShop.ViewModels.ShoppingCartIndexViewModel

@using OShop.Helpers

@{
    Layout.Title = T("My shopping cart");
}

<div class="shopping-cart-container">
    @if (Model.CartItems.Any()) {
        using (Html.BeginFormAntiForgeryPost(Url.Action("Update", "ShoppingCart", new { area = "OShop" }))) {
            <div class="cart-actions-head">
                @Html.ActionLink(T("Empty cart").Text, "Empty", "ShoppingCart", new { Area = "OShop" }, new { })
            </div>
            <table class="cart-items">
                <thead>
                    <tr>
                        <th>@T("SKU")</th>
                        <th>@T("Product")</th>
                        <th>@T("Unit Price")</th>
                        <th>@T("Qty.")</th>
                        <th>@T("Total")</th>
                        <th></th>
                    </tr>
                </thead>
                @{
                    int i = 0;
                }
                @foreach (var entry in Model.CartItems) {
                    <tr>
                        <td>@entry.Item.SKU</td>
                        <td>
                            <div class="designation">
                                @if (entry.Item.Content != null) {
                                    @Html.ItemDisplayLink(entry.Item.Designation, entry.Item.Content)
                                }
                                else {
                                    @entry.Item.Designation
                                }
                            </div>
                            @if (!String.IsNullOrWhiteSpace(entry.Item.Description)) {
                                <div class="description">@entry.Item.Description</div>
                            }
                        </td>



                        <td>
                            @if (Model.VatEnabled) {
                                @String.Format(Model.NumberFormat, "{0:C}", entry.VatIncludedUnitPrice())
                            }
                            else {
                                @String.Format(Model.NumberFormat, "{0:C}", entry.UnitPrice())
                            }
                        </td>
                        <td>
                            <input type="hidden" name="@String.Format("CartItems[{0}].Id", i)" value="@entry.Id" />
                            <input type="number" name="@String.Format("CartItems[{0}].Quantity", i)" value="@entry.Quantity" class="quantity" />
                        </td>
                        <td>
                            @if (Model.VatEnabled && entry.Item.VAT != null) {
                                @String.Format(Model.NumberFormat, "{0:C}", entry.VatIncludedSubTotal())
                            }
                            else {
                                @String.Format(Model.NumberFormat, "{0:C}", entry.SubTotal())
                            }
                        </td>
                        <td>
                            <button type="submit" name="@String.Format("CartItems[{0}].IsRemoved", i)" value="true">@T("Remove")</button>
                        </td>
                    </tr>
                    i++;
                }
                <tfoot>
                    <tr class="total">
                        <td colspan="4">
                            @T("Total")
                        </td>
                        <td>
                            @if (Model.VatEnabled) {
                                @String.Format(Model.NumberFormat, "{0:C}", Model.CartItems.Sum(ci => ci.VatIncludedSubTotal()))
                            }
                            else {
                                @String.Format(Model.NumberFormat, "{0:C}", Model.CartItems.Sum(ci => ci.SubTotal()))
                            }
                        </td>
                    </tr>
                </tfoot>
            </table>
            <div class="cart-actions-foot">
                <button type="submit" name="UpdateAll" value="true">@T("Update")</button>
            </div>
        }
    }
    else {
        <p class="cart-empty">
            @T("Your shopping cart is empty.")
        </p>
    }
</div>